<!DOCTYPE html>
<html>
<head>
    <title>Category & Navigation Tracking Test</title>
    <style>
        body { font-family: system-ui; margin: 2rem; }
        .result { margin: 1rem 0; padding: 0.5rem; border-radius: 4px; }
        .pass { background: #d4edda; border: 1px solid #c3e6cb; }
        .fail { background: #f8d7da; border: 1px solid #f5c6cb; }
        button, .filter-btn { margin: 0.5rem; padding: 0.5rem 1rem; cursor: pointer; }
        .category-filter.active, .tag-filter.active { background: #3584e4; color: white; }
        .card { margin: 0.5rem; padding: 1rem; border: 1px solid #ddd; display: inline-block; }
        #search-input { margin: 0.5rem; padding: 0.5rem; }
    </style>
</head>
<body>
    <h1>Category & Navigation Tracking Test</h1>
    
    <!-- Mock search input -->
    <input type="text" id="search-input" placeholder="Search apps..." />
    
    <!-- Mock category filters -->
    <div>
        <button class="category-filter" data-category="productivity">Productivity</button>
        <button class="category-filter" data-category="graphics">Graphics</button>
        <button class="tag-filter" data-tag="gtk">GTK</button>
        <button class="tag-filter" data-tag="gnome">GNOME</button>
    </div>
    
    <!-- Mock app cards -->
    <div>
        <div class="card" data-name="Test App 1" data-category="productivity" href="/apps/test-app-1/">
            Test App 1 (Productivity)
        </div>
        <div class="card" data-name="Test App 2" data-category="graphics" href="/apps/test-app-2/">
            Test App 2 (Graphics)
        </div>
    </div>
    
    <div id="results"></div>
    <button onclick="runTests()">Run Tests</button>
    <button onclick="showJourneyData()">Show Journey Data</button>
    <button onclick="clearResults()">Clear</button>

    <script src="assets/js/privacy-analytics.js"></script>
    <script>
        function addResult(test, passed, message = '') {
            const div = document.createElement('div');
            div.className = `result ${passed ? 'pass' : 'fail'}`;
            div.textContent = `${passed ? '✓' : '✗'} ${test}: ${message}`;
            document.getElementById('results').appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function runTests() {
            clearResults();
            
            // Test 1: Filter click tracking
            const productivityFilter = document.querySelector('[data-category="productivity"]');
            productivityFilter.classList.add('active');
            productivityFilter.click();
            
            setTimeout(() => {
                const journeyData = window.exportJourneyData();
                addResult('Filter Tracking', 
                    journeyData.filters > 0,
                    `${journeyData.filters} filters tracked`);
            }, 100);
            
            // Test 2: Navigation tracking with filters
            setTimeout(() => {
                const card = document.querySelector('.card[data-name="Test App 1"]');
                card.click();
                
                setTimeout(() => {
                    const journeyData = window.exportJourneyData();
                    addResult('Navigation Tracking',
                        journeyData.navs > 0,
                        `${journeyData.navs} navigations tracked`);
                }, 100);
            }, 200);
            
            // Test 3: Search + filter interaction
            setTimeout(() => {
                const searchInput = document.getElementById('search-input');
                searchInput.value = 'test';
                searchInput.dispatchEvent(new Event('input'));
                
                setTimeout(() => {
                    const gtkFilter = document.querySelector('[data-tag="gtk"]');
                    gtkFilter.classList.add('active');
                    gtkFilter.click();
                    
                    setTimeout(() => {
                        const journeyData = window.exportJourneyData();
                        addResult('Search + Filter Interaction',
                            journeyData.searches > 0 && journeyData.filters > 1,
                            `Searches: ${journeyData.searches}, Filters: ${journeyData.filters}`);
                    }, 100);
                }, 1100); // Wait for search debounce
            }, 400);
        }

        function showJourneyData() {
            if (window.exportJourneyData) {
                const data = window.exportJourneyData();
                const div = document.createElement('div');
                div.className = 'result pass';
                div.innerHTML = `<strong>Journey Data:</strong><br><pre>${JSON.stringify(data, null, 2)}</pre>`;
                document.getElementById('results').appendChild(div);
            }
        }

        // Add click listeners to filters for testing
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('category-filter') || e.target.classList.contains('tag-filter')) {
                e.target.classList.toggle('active');
            }
        });
    </script>
</body>
</html>