{% if type == "icon" %}
<img src="https://raw.githubusercontent.com/{{ app.github }}/main/data/icons/hicolor/128x128/apps/{{ app.flathub }}.png" alt="{{ app.name }}" class="{{ class }}" width="128" height="128">

{% elsif type == "screenshot" %}
  {% assign app_images = site.data.image_manifest.apps[app.slug] %}
  {% if app_images.screenshots and app_images.screenshots.size > index %}
    {% assign screenshot = app_images.screenshots[index] %}
    {% if screenshot.variants and screenshot.variants.size > 0 %}
      {% assign largest = screenshot.variants.last %}
      <picture class="{{ class }}">
        <!-- WebP sources -->
        <source srcset="{% for variant in screenshot.variants %}/{{ variant.webp }} {{ variant.width }}w{% unless forloop.last %}, {% endunless %}{% endfor %}" 
                type="image/webp"
                sizes="(max-width: 640px) 100vw, (max-width: 1024px) 90vw, 1200px">
        <!-- JPEG fallback -->
        <source srcset="{% for variant in screenshot.variants %}/{{ variant.jpeg }} {{ variant.width }}w{% unless forloop.last %}, {% endunless %}{% endfor %}"
                sizes="(max-width: 640px) 100vw, (max-width: 1024px) 90vw, 1200px">
        <img src="/{{ largest.jpeg }}" 
             alt="{{ alt | default: 'Screenshot' }}"
             class="{{ class }}"
             width="{{ largest.width }}"
             height="600"
             loading="lazy">
      </picture>
    {% else %}
      <!-- Fallback to Flathub CDN -->
      {% if app.screenshots and app.screenshots.size > index %}
        {% assign screenshot_name = app.screenshots[index] %}
        <img src="https://dl.flathub.org/media/{{ app.flathub | replace: '.', '/' }}/screenshots/{{ screenshot_name }}_orig.webp"
             alt="{{ alt | default: 'Screenshot' }}"
             class="{{ class }}"
             width="1024"
             height="600"
             loading="lazy">
      {% endif %}
    {% endif %}
  {% endif %}
{% endif %}