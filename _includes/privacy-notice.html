<!-- Privacy Notice Component for Tobagin Apps Portfolio -->
<div class="privacy-notice" id="privacy-notice">
  <div class="privacy-notice-content">
    <div class="privacy-header">
      <h3>üîí Privacy & Data Collection Notice</h3>
      <button class="privacy-toggle" onclick="togglePrivacyDetails()" aria-label="Toggle privacy details">
        <span id="privacy-toggle-icon">‚ÑπÔ∏è</span>
        <span id="privacy-toggle-text">Show Details</span>
      </button>
    </div>
    
    <div class="privacy-summary">
      <p><strong>Quick Summary:</strong> We use anonymous, privacy-first analytics to understand how visitors use our GNOME app portfolio. No cookies, no tracking, no personal data collection.</p>
    </div>

    <div class="privacy-details" id="privacy-details" style="display: none;">
      <div class="privacy-section">
        <h4>üìä What Data We Collect</h4>
        <ul>
          <li><strong>Anonymous Page Views:</strong> Which app pages you visit (without identifying you)</li>
          <li><strong>App Interactions:</strong> Clicks on Flathub links, GitHub repos, documentation</li>
          <li><strong>Search Queries:</strong> Anonymous search terms (sanitized and truncated)</li>
          <li><strong>Navigation Patterns:</strong> Anonymous journey through the site</li>
          <li><strong>Technical Info:</strong> Browser type, screen size, language preference</li>
        </ul>
      </div>

      <div class="privacy-section">
        <h4>üö´ What We DON'T Collect</h4>
        <ul>
          <li>‚ùå No cookies or persistent identifiers</li>
          <li>‚ùå No IP addresses or location data</li>
          <li>‚ùå No personal information (name, email, etc.)</li>
          <li>‚ùå No user accounts or login tracking</li>
          <li>‚ùå No third-party tracking pixels</li>
          <li>‚ùå No cross-site tracking</li>
        </ul>
      </div>

      <div class="privacy-section">
        <h4>üéØ Why We Collect This Data</h4>
        <p><strong>Legitimate Interest:</strong> To improve our GNOME app portfolio and understand which applications are most useful to the community.</p>
        <ul>
          <li>Identify popular GNOME applications</li>
          <li>Improve site navigation and search</li>
          <li>Understand which resources (docs, GitHub, etc.) are most helpful</li>
          <li>Optimize for better user experience</li>
        </ul>
      </div>

      <div class="privacy-section">
        <h4>üîê How We Protect Your Privacy</h4>
        <ul>
          <li><strong>Local Processing:</strong> Data processed in your browser, not sent to external servers</li>
          <li><strong>Anonymization:</strong> All data is anonymous from collection to storage</li>
          <li><strong>Data Minimization:</strong> We collect only what's necessary for analytics</li>
          <li><strong>Temporary Storage:</strong> Data kept only for current browser session</li>
          <li><strong>No Profiling:</strong> We don't build user profiles or behavioral tracking</li>
        </ul>
      </div>

      <div class="privacy-section" id="gdpr-section">
        <h4>üá™üá∫ Your Rights Under GDPR</h4>
        <p>If you're in the European Union, you have enhanced privacy rights:</p>
        <ul>
          <li><strong>Right to Access:</strong> <button onclick="exportUserData()">Export Your Data</button></li>
          <li><strong>Right to Erasure:</strong> <button onclick="deleteUserData()">Clear All Data</button></li>
          <li><strong>Right to Object:</strong> <button onclick="optOutAnalytics()">Opt Out of Analytics</button></li>
          <li><strong>Right to Portability:</strong> Download your data in JSON format</li>
          <li><strong>Right to Rectification:</strong> N/A (anonymous data cannot be corrected)</li>
        </ul>
      </div>

      <div class="privacy-section">
        <h4>‚öôÔ∏è Your Privacy Controls</h4>
        <div class="privacy-controls">
          <div class="control-group">
            <h5>Current Status:</h5>
            <div id="analytics-status">Loading...</div>
          </div>
          
          <div class="control-group">
            <h5>Analytics Controls:</h5>
            <div class="button-group">
              <button onclick="window.analyticsOptIn()" class="btn-primary">Enable Analytics</button>
              <button onclick="window.analyticsOptOut()" class="btn-secondary">Disable Analytics</button>
              <button onclick="showAnalyticsData()" class="btn-info">View Collected Data</button>
            </div>
          </div>
          
          <div class="control-group" id="eu-controls" style="display: none;">
            <h5>EU Consent Level:</h5>
            <div class="button-group">
              <button onclick="setConsentLevel('full')" class="btn-success">Full Analytics</button>
              <button onclick="setConsentLevel('minimal')" class="btn-warning">Minimal Only</button>
              <button onclick="setConsentLevel('rejected')" class="btn-danger">Reject All</button>
            </div>
          </div>
        </div>
      </div>

      <div class="privacy-section">
        <h4>üìû Contact & Questions</h4>
        <p>Questions about data collection or privacy?</p>
        <ul>
          <li><strong>Email:</strong> <a href="mailto:privacy@tobagin.dev">privacy@tobagin.dev</a></li>
          <li><strong>Issues:</strong> <a href="https://github.com/tobagin/tobagin.github.io/issues" target="_blank">GitHub Issues</a></li>
        </ul>
      </div>

      <div class="privacy-section">
        <h4>üìÖ Last Updated</h4>
        <p>This privacy notice was last updated on <strong>{{ site.time | date: "%B %d, %Y" }}</strong>.</p>
        <p><small>Version 1.0.0 - Initial privacy-first analytics implementation</small></p>
      </div>
    </div>
  </div>
</div>

<style>
.privacy-notice {
  background: var(--bg-secondary, #f8f9fa);
  border: 1px solid var(--border-color, #dee2e6);
  border-radius: 8px;
  margin: 2rem 0;
  padding: 0;
  font-size: 0.95rem;
  line-height: 1.6;
}

.privacy-notice-content {
  padding: 1.5rem;
}

.privacy-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border-color, #dee2e6);
}

.privacy-header h3 {
  margin: 0;
  color: var(--text-primary, #2e3440);
  font-size: 1.25rem;
}

.privacy-toggle {
  background: var(--accent-color, #3584e4);
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: background-color 0.2s;
}

.privacy-toggle:hover {
  background: var(--accent-hover, #1c71d8);
}

.privacy-summary {
  color: var(--text-secondary, #5e6472);
  font-weight: 500;
}

.privacy-details {
  margin-top: 1.5rem;
}

.privacy-section {
  margin-bottom: 2rem;
}

.privacy-section h4 {
  color: var(--text-primary, #2e3440);
  font-size: 1.1rem;
  margin-bottom: 0.75rem;
  padding-bottom: 0.25rem;
  border-bottom: 1px solid var(--border-light, #f1f3f4);
}

.privacy-section ul {
  margin: 0.5rem 0;
  padding-left: 1.5rem;
}

.privacy-section li {
  margin-bottom: 0.5rem;
}

.privacy-controls {
  background: white;
  border: 1px solid var(--border-color, #dee2e6);
  border-radius: 6px;
  padding: 1rem;
  margin-top: 1rem;
}

.control-group {
  margin-bottom: 1rem;
}

.control-group:last-child {
  margin-bottom: 0;
}

.control-group h5 {
  margin: 0 0 0.5rem 0;
  color: var(--text-primary, #2e3440);
  font-size: 1rem;
}

.button-group {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.button-group button {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.2s;
}

.btn-primary { background: #3584e4; color: white; }
.btn-primary:hover { background: #1c71d8; }

.btn-secondary { background: #6c757d; color: white; }
.btn-secondary:hover { background: #545b62; }

.btn-info { background: #17a2b8; color: white; }
.btn-info:hover { background: #138496; }

.btn-success { background: #28a745; color: white; }
.btn-success:hover { background: #218838; }

.btn-warning { background: #ffc107; color: #212529; }
.btn-warning:hover { background: #e0a800; }

.btn-danger { background: #dc3545; color: white; }
.btn-danger:hover { background: #c82333; }

#analytics-status {
  font-family: monospace;
  background: #f8f9fa;
  padding: 0.5rem;
  border-radius: 4px;
  font-size: 0.9rem;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .privacy-notice {
    background: var(--bg-secondary, #3d3846);
    border-color: var(--border-color, #5e5c64);
  }
  
  .privacy-header h3 {
    color: var(--text-primary, #f6f5f4);
  }
  
  .privacy-section h4 {
    color: var(--text-primary, #f6f5f4);
  }
  
  .privacy-controls {
    background: var(--bg-primary, #242730);
    border-color: var(--border-color, #5e5c64);
  }
  
  #analytics-status {
    background: #242730;
    color: #f6f5f4;
  }
}

/* Mobile responsive */
@media (max-width: 768px) {
  .privacy-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }
  
  .privacy-toggle {
    align-self: flex-end;
  }
  
  .button-group {
    flex-direction: column;
  }
  
  .button-group button {
    width: 100%;
  }
}
</style>

<script>
function togglePrivacyDetails() {
  const details = document.getElementById('privacy-details');
  const icon = document.getElementById('privacy-toggle-icon');
  const text = document.getElementById('privacy-toggle-text');
  
  if (details.style.display === 'none') {
    details.style.display = 'block';
    icon.textContent = 'üîΩ';
    text.textContent = 'Hide Details';
  } else {
    details.style.display = 'none';
    icon.textContent = '‚ÑπÔ∏è';
    text.textContent = 'Show Details';
  }
}

function updateAnalyticsStatus() {
  const statusDiv = document.getElementById('analytics-status');
  const euControls = document.getElementById('eu-controls');
  
  if (typeof window.getAnalyticsStatus === 'function') {
    const status = window.getAnalyticsStatus();
    statusDiv.innerHTML = `
      <div>Analytics: <strong>${status.enabled ? 'Enabled' : 'Disabled'}</strong></div>
      <div>Do Not Track: <strong>${status.dnt ? 'Enabled' : 'Disabled'}</strong></div>
      <div>Events Collected: <strong>${status.events}</strong></div>
      <div>Session ID: <code>${status.session}</code></div>
    `;
    
    // Check for EU consent status
    if (typeof window.getEUConsentStatus === 'function') {
      const euConsent = window.getEUConsentStatus();
      if (euConsent) {
        euControls.style.display = 'block';
        statusDiv.innerHTML += `<div>EU Consent Level: <strong>${euConsent.level}</strong></div>`;
      }
    }
  } else {
    statusDiv.innerHTML = '<div>Analytics system not loaded</div>';
  }
}

function exportUserData() {
  if (typeof window.exportEngagementData === 'function' && typeof window.exportJourneyData === 'function') {
    const engagement = window.exportEngagementData();
    const journey = window.exportJourneyData();
    const exportData = {
      engagement,
      journey,
      exportedAt: new Date().toISOString(),
      gdprCompliant: true
    };
    
    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `tobagin-analytics-data-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert('‚úÖ Your analytics data has been exported as a JSON file.');
  } else {
    alert('‚ùå Export functionality not available - analytics system not loaded.');
  }
}

function deleteUserData() {
  if (confirm('Are you sure you want to delete all collected analytics data? This action cannot be undone.')) {
    // Clear all analytics data
    if (typeof window.PrivacyAnalytics === 'object') {
      window.PrivacyAnalytics.resetEngagementData();
    }
    
    // Clear consent data
    if (typeof window.withdrawEUConsent === 'function') {
      window.withdrawEUConsent();
    }
    
    // Opt out of analytics
    if (typeof window.analyticsOptOut === 'function') {
      window.analyticsOptOut();
    }
    
    updateAnalyticsStatus();
    alert('‚úÖ All analytics data has been deleted and you have been opted out.');
  }
}

function showAnalyticsData() {
  if (typeof window.exportEngagementData === 'function') {
    const data = window.exportEngagementData();
    const journey = window.exportJourneyData();
    
    const popup = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
    popup.document.write(`
      <html>
        <head>
          <title>Your Analytics Data - Tobagin Apps</title>
          <style>
            body { font-family: system-ui; margin: 2rem; line-height: 1.6; }
            pre { background: #f8f9fa; padding: 1rem; border-radius: 4px; overflow-x: auto; }
            .section { margin: 2rem 0; border: 1px solid #ddd; border-radius: 8px; padding: 1rem; }
            .section h3 { margin-top: 0; color: #3584e4; }
          </style>
        </head>
        <body>
          <h1>üîí Your Analytics Data</h1>
          <p>This is all the data we have collected about your visit. No personal information is included.</p>
          
          <div class="section">
            <h3>üìä Engagement Data</h3>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          </div>
          
          <div class="section">
            <h3>üß≠ Journey Data</h3>
            <pre>${JSON.stringify(journey, null, 2)}</pre>
          </div>
          
          <p><strong>Privacy Note:</strong> This data is anonymous and cannot be used to identify you personally.</p>
        </body>
      </html>
    `);
  } else {
    alert('‚ùå Cannot display data - analytics system not loaded.');
  }
}

function setConsentLevel(level) {
  if (typeof window.setEUConsent === 'function') {
    window.setEUConsent(level);
    
    // Update analytics based on consent level
    if (level === 'rejected') {
      window.analyticsOptOut();
    } else {
      window.analyticsOptIn();
    }
    
    updateAnalyticsStatus();
    alert(`‚úÖ EU consent level set to: ${level}`);
  } else {
    alert('‚ùå EU consent management not available.');
  }
}

// Initialize status when page loads
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(updateAnalyticsStatus, 1000); // Wait for analytics to initialize
});
</script>